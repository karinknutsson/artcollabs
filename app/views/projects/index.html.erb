<% if ["noresults"].include? params[:search] %>
    <div class="results text-center" style="margin-top: 80px">
        <h5>No search results for <%= params[:searched] %>.</h5>
    </div>
<% else %>
    <% if params[:query].present? && params[:query].length.positive? %>
        <div class="results text-center" style="margin-top: 80px">
            <h5>Results for <%= params[:query] %>:</h5>
        </div>
    <% end %>

    <div class="index-card-container">

      <% @projects.each do |project| %>

        <div class="index-card">

          <%= link_to project_path(project) do %>
            <div class="card-image">
              <% if project.photo.attached? %>
                <%= cl_image_tag(project.photo.key) %>
              <% else %>
                <%= image_tag "clouds.jpg" %>
              <% end %>
            </div>

            <div class="card-title">
              <h6><%= project.title %></h6>
            </div>

              <div class="card-roles">
                <i class="fas fa-users user-icon"></i>
                <% if project.max_members.present? %>
                  <% free_spots = project.max_members - @collabs.where(project_id: project.id).length %>
                  <% if free_spots > 1 %>
                    <%= free_spots %> more people can join
                  <% elsif free_spots == 1 %>
                    1 more person can join
                  <% else %>
                    project is full
                  <% end %>
                <% else %>
                  open team size
                <% end %>
              </div>
          <% end %>

            <div class="card-tags">
              <% if project.tag_list %>
                <% project.tag_list.each do |tag| %>
                  <div class="a-tag"><%= link_to "##{tag}", tagged_path(tag: tag) %></div>
                <% end %>
              <% end %>
            </div>

          <div class="card-user user-avatar">
            <%= link_to profile_path(project.user), class: "card-user-link" do %>
              <%= project.user.username %>
              <% if project.user.avatar.attached? %>
                <%= cl_image_tag(project.user.avatar.key) %>
              <% else %>
                <div class="avatar-member">
                  <%= render "shared/avatar" %>
                </div>
              <% end %>
            <% end %>
          </div>

        </div>

      <% end %>

    </div>

    <div class="pagination text-center" style="margin-top: 10px" >
      <%= paginate @projects %>
    </div>

<% end %>
